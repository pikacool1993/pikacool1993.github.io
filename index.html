<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.0.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.0" color="#222">





  <meta name="keywords" content="Unity OC,">










<meta name="description" content="Unity 和 Objective-C 交互Unity 调用 iOS 原生方法在 iOS 中，C 语言可以和 Objective-C 语言进行混合编译的，C# 语言又提供了一种调用 C（非 C++）语言的机制， 这样就可以实现 C# 调用 Objective-C 的功能 IL2CPP What is IL2CPP?The technology that we refer to as IL2CPP">
<meta name="keywords" content="Unity OC">
<meta property="og:type" content="article">
<meta property="og:title" content="Unity iOS 插件实践">
<meta property="og:url" content="https://github.com/pikacool1993/2021/02/23/unity-ios-plugin/index.html">
<meta property="og:site_name" content="Pikacool">
<meta property="og:description" content="Unity 和 Objective-C 交互Unity 调用 iOS 原生方法在 iOS 中，C 语言可以和 Objective-C 语言进行混合编译的，C# 语言又提供了一种调用 C（非 C++）语言的机制， 这样就可以实现 C# 调用 Objective-C 的功能 IL2CPP What is IL2CPP?The technology that we refer to as IL2CPP">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://blogs.unity3d.com/wp-content/uploads/2015/04/il2cpp-toolchain-smaller.png">
<meta property="og:updated_time" content="2021-02-23T06:39:52.853Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Unity iOS 插件实践">
<meta name="twitter:description" content="Unity 和 Objective-C 交互Unity 调用 iOS 原生方法在 iOS 中，C 语言可以和 Objective-C 语言进行混合编译的，C# 语言又提供了一种调用 C（非 C++）语言的机制， 这样就可以实现 C# 调用 Objective-C 的功能 IL2CPP What is IL2CPP?The technology that we refer to as IL2CPP">
<meta name="twitter:image" content="https://blogs.unity3d.com/wp-content/uploads/2015/04/il2cpp-toolchain-smaller.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://github.com/pikacool1993/2021/02/23/unity-ios-plugin/">





  <title>Pikacool</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Pikacool</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">也曾鲜衣怒马少年时，一夜忘尽长安花</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/pikacool1993/2021/02/23/unity-ios-plugin/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="pikacool">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pikacool">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/02/23/unity-ios-plugin/" itemprop="url">Unity iOS 插件实践</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-02-23T10:37:22+08:00">2021-02-23</time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Unity-和-Objective-C-交互"><a href="#Unity-和-Objective-C-交互" class="headerlink" title="Unity 和 Objective-C 交互"></a>Unity 和 Objective-C 交互</h3><h4 id="Unity-调用-iOS-原生方法"><a href="#Unity-调用-iOS-原生方法" class="headerlink" title="Unity 调用 iOS 原生方法"></a>Unity 调用 iOS 原生方法</h4><p>在 <code>iOS</code> 中，<code>C</code> 语言可以和 <code>Objective-C</code> 语言进行混合编译的，<code>C#</code> 语言又提供了一种调用 <code>C</code>（非 <code>C++</code>）语言的机制， 这样就可以实现 <code>C#</code> 调用 <code>Objective-C</code> 的功能</p>
<h5 id="IL2CPP"><a href="#IL2CPP" class="headerlink" title="IL2CPP"></a>IL2CPP</h5><blockquote>
<p>What is IL2CPP?<br>The technology that we refer to as IL2CPP has two distinct parts.<br>1. An ahead-of-time (AOT) compiler<br>2. A runtime library to support the virtual machine<br>The AOT compiler translates Intermediate Language (IL), the low-level output from .NET compilers, to C++ source code. The runtime library provides services and abstractions like a garbage collector, platform-independent access to threads and files, and implementations of internal calls (native code which modifies managed data structures directly).</p>
</blockquote>
<p><img src="https://blogs.unity3d.com/wp-content/uploads/2015/04/il2cpp-toolchain-smaller.png" alt="LayoutEngine.png"></p>
<p>Unity脚本编译成中间语言（<code>IL</code>，动态库等），通过IL2CPP程序将 <code>IL</code> 转换成 <code>C++</code>语言</p>
<h5 id="DllImport"><a href="#DllImport" class="headerlink" title="DllImport"></a>DllImport</h5><p><code>C#</code> 提供了 <code>DllImport</code> 机制来实现 <code>C#</code> 于 <code>C</code> 语言的方法调用</p>
<ul>
<li>无参无返回值</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">DllImport(<span class="meta-string">"__Internal"</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">CallFunction</span>(<span class="params"></span>)</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>有参无返回值</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">DllImport(<span class="meta-string">"__Internal"</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">CallFunction</span>(<span class="params"><span class="keyword">string</span> param</span>)</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>有参有返回值</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">DllImport(<span class="meta-string">"__Internal"</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">string</span> <span class="title">CallFunction</span>(<span class="params"><span class="keyword">string</span> param</span>)</span>;</span><br></pre></td></tr></table></figure>

<h6 id="DllImport-的语法规则"><a href="#DllImport-的语法规则" class="headerlink" title="DllImport 的语法规则"></a>DllImport 的语法规则</h6><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">DllImport(<span class="meta-string">"__Internal"</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">extern</span> ReturnValue <span class="title">FunctionName</span>(<span class="params"><span class="keyword">string</span> parameter1, <span class="keyword">int</span> parameter2</span>)</span>;</span><br></pre></td></tr></table></figure>

<p>由于是 <code>C</code> 语言，支持的参数及其数据类型是非常有限的，诸如 <code>int</code>、<code>float</code>、<code>double</code>、<code>char</code> 等这类两种语言中都存在的基础数据类型，是可以实现直接映射的，但是 <code>C#</code> 中的 <code>string</code> 对应到 <code>C</code> 中，就是 <code>char*</code> 了</p>
<h6 id="iOS-实现-DllImport"><a href="#iOS-实现-DllImport" class="headerlink" title="iOS 实现 DllImport"></a>iOS 实现 DllImport</h6><p><code>.h</code> 文件中</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123;</span><br><span class="line">	<span class="keyword">char</span>* CallFunction(<span class="keyword">char</span> *parma);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>.mm</code> 文件中</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span>* CallFunction(<span class="keyword">char</span> *parma) &#123;</span><br><span class="line">	<span class="comment">// return ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="iOS-调用-Unity-原生方法"><a href="#iOS-调用-Unity-原生方法" class="headerlink" title="iOS 调用 Unity 原生方法"></a>iOS 调用 Unity 原生方法</h6><p>这种方式用于 <code>iOS</code> 给 <code>Unity</code> 一些方法回调</p>
<ul>
<li><code>MonoPInvokeCallback</code></li>
</ul>
<blockquote>
<p>Attribute used to annotate functions that will be called back from the unmanaged world.</p>
</blockquote>
<p>举个栗子🌰，比如我们现在需要使用手机相册权限拿一张图片在 <code>Unity</code> 中使用</p>
<p><code>C#</code> 中：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明 Unity 中接收回调的事件</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> UnityAction&lt;<span class="keyword">string</span>&gt; _selectPhotoAction;</span><br><span class="line"><span class="comment">// 声明回调代理</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">SelectPhotoCallback</span>(<span class="params"><span class="keyword">string</span> photo</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在一个初始化方法中设置回调</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Init</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	_SetSelectPhotoCallback(DidReceiveSelectPhotoCallback);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 供 Unity 中调用选择照片的方法，并传入一个选择结果的回调</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnSelectPhoto</span>(<span class="params">UnityAction&lt;<span class="keyword">string</span>&gt; callback</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	_selectPhotoAction = callback;</span><br><span class="line">	_SelectPhoto();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// iOS 原生的回调</span></span><br><span class="line">[<span class="meta">AOT.MonoPInvokeCallback(typeof(SelectPhotoCallback))</span>]</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">DidReceiveSelectPhotoCallback</span>(<span class="params"><span class="keyword">string</span> photo</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	_selectPhotoAction?.Invoke(photo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把 Unity 中定义的接收原生事件回调传给 OC</span></span><br><span class="line">[<span class="meta">DllImport(<span class="meta-string">"__Internal"</span>)</span>]</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> _SetupSelectPhotoCallback(SelectPhotoCallback callback);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 OC 原生方法</span></span><br><span class="line">[<span class="meta">DllImport(<span class="meta-string">"__Internal"</span>)</span>]</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> _SelectPhoto();</span><br></pre></td></tr></table></figure>

<p><code>OC</code> 中</p>
<p><code>.h</code> 文件中：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NativeUtils</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(*SelectPhotoCallback)(<span class="keyword">const</span> <span class="keyword">char</span> *photo);</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> _SetupSelectPhotoCallback(SelectPhotoCallback callback);</span><br><span class="line">    <span class="keyword">void</span> _SelectPhoto();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p><code>.mm</code> 文件中：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#define Convert2Char( _x_ ) ( _x_ != NULL &amp;&amp; [_x_ isKindOfClass:[NSString class]] ) ? strdup( [_x_ UTF8String] ) : strdup( [@<span class="meta-string">""</span> UTF8String] )</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NativeUtils</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) SelectPhotoCallback selectPhotoCallback;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">WMNativeUtils</span></span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">instancetype</span>)shared &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="keyword">static</span> NativeUtils *instance = <span class="literal">nil</span>;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken,^&#123;</span><br><span class="line">        instance = [[<span class="keyword">self</span> alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)bindSelectPhotoCallback:(SelectPhotoCallback)callback &#123;</span><br><span class="line">    <span class="keyword">self</span>.selectPhotoCallback = callback;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)selectPhoto &#123;</span><br><span class="line">	<span class="comment">// 调起系统相册，选择...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark UIImagePickerControllerDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)imagePickerController:(<span class="built_in">UIImagePickerController</span> *)picker didFinishPickingMediaWithInfo:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">UIImagePickerControllerInfoKey</span>,<span class="keyword">id</span>&gt; *)info &#123;</span><br><span class="line">    [picker dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">    <span class="built_in">UIImage</span> *image = info[<span class="built_in">UIImagePickerControllerEditedImage</span>];</span><br><span class="line">    <span class="comment">// base64 形式</span></span><br><span class="line">    <span class="built_in">NSString</span> *imageBase64String = [imageData base64EncodedStringWithOptions:<span class="built_in">NSDataBase64EncodingEndLineWithLineFeed</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.selectPhotoCallback) &#123;</span><br><span class="line">        <span class="keyword">self</span>.selectPhotoCallback(Convert2Char(imageBase64String));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - CPlusPlus</span></span><br><span class="line"><span class="keyword">void</span> _SetupSelectPhotoCallback(SelectPhotoCallback callback) &#123;</span><br><span class="line">    [[NativeUtils shared] bindSelectPhotoCallback:callback];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> _SelectPhoto() &#123;</span><br><span class="line">    [[NativeUtils shared] selectPhoto];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/pikacool1993/2021/02/22/objc-interface/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="pikacool">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pikacool">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/02/22/objc-interface/" itemprop="url">Objective-C中的@interface和@implementation</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-02-22T17:09:33+08:00">2021-02-22</time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Objective-C中的-interface和-implementation"><a href="#Objective-C中的-interface和-implementation" class="headerlink" title="Objective-C中的@interface和@implementation"></a>Objective-C中的@interface和@implementation</h3><h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>Objc的类声明使用 <code>interface</code> ，但是在其它面向对象的语言中使用 <code>class</code> 来表示，<code>interface</code> 在 Java 中近似于 Objc 中的 <code>protocol</code>, 所以 Objc 中的 <code>interface</code> 以及 <code>implementation</code> 的设计思想是什么呢？</p>
<h4 id="interface"><a href="#interface" class="headerlink" title="@interface"></a>@interface</h4><p>引用一段官方的解释</p>
<blockquote>
<p>This information goes into the interface for your class—it defines the way you intend other objects to interact with instances of your class. The public interface is described separately from the internal behavior of your class, which makes up the class implementation. In Objective-C, the interface and implementation are usually placed in separate files so that you only need to make the interface public. </p>
</blockquote>
<p>大概意思就是它定义了你希望与其它对象和类实例进行交互的方式，也就是 <code>interface</code> 只存在于能相互影响的两者间</p>
<h4 id="那么问题来了-interface-生成了-class"><a href="#那么问题来了-interface-生成了-class" class="headerlink" title="那么问题来了 @interface 生成了 class?"></a>那么问题来了 <code>@interface</code> 生成了 <code>class</code>?</h4><p>刚接触 Objc 时肯定是从怎么写一个类开始的，在 <code>.h</code> 文件中写 <code>@interface</code> 声明类，然后在 <code>.m</code> 文件中写 <code>@implementation</code>，所以自然就会觉得是 <code>@interface</code> 就相当于 java 或者 C# 中写一个 <code>class</code></p>
<p>Talk is cheap. Show me the code</p>
<p>在 <code>Dog</code> 类中只有 <code>.m</code> 文件只写 <code>@implementation</code>，在 <code>Cat</code> 类中只有 <code>.h</code> 文件只写 <code>@interface</code></p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Dog</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Cat</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>验证</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Class dogClass = <span class="built_in">NSClassFromString</span>(<span class="string">@"Dog"</span>);</span><br><span class="line">Class catClass = <span class="built_in">NSClassFromString</span>(<span class="string">@"Cat"</span>);</span><br><span class="line">    </span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"Dog: %@"</span>, dogClass);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"Cat: %@"</span>, catClass);</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ Dog: Dog</span><br><span class="line">$ Cat: (null)</span><br></pre></td></tr></table></figure>

<p>这个结果说明是 <code>@implementation</code> 生成了 <code>class</code></p>
<h4 id="interface和-implementation"><a href="#interface和-implementation" class="headerlink" title="@interface和@implementation"></a>@interface和@implementation</h4><p><code>@interface</code> 对类结构的合成没有决定性的作用， 只是没有它会丢失一些类自身的原始数据，如属性列表和协议列表，对对象消息发送并没有影响，所以 <code>@interface</code> 就是为了给调用者看，暴露自己的公有方法和属性等，是一个升级版的 <code>protocol</code></p>
<h4 id="interface和-protocol"><a href="#interface和-protocol" class="headerlink" title="@interface和@protocol"></a>@interface和@protocol</h4><p><code>@interface</code> 和 <code>@protocal</code> 间唯一的区别就是是否和一个类型绑定</p>
<p>比如我们常常定义一个代理 <code>id&lt;XXDelegate&gt; delegate</code> 我们就不用知道这个代理到底是什么类型的，只用知道它能干什么就好了，同样可以这样定义 <code>XXDelegate *delegate</code>, 这样就会耦合一个 <code>XXDelegate</code> 类型，我们并不需要关心它是什么</p>
<h4 id="一个问题"><a href="#一个问题" class="headerlink" title="一个问题"></a>一个问题</h4><p>当子类需要使用父类的一个私有属性（方法）时，需要把这个属性（方法）放到父类的header中，但暴露给子类的同时暴露给了外部调用者，如何解决?</p>
<p>建立一个私有header，使用类扩展定义父类需要暴露给子类的属性（方法），然后在各自的 <code>.m</code> 文件中引用，如：</p>
<p>有 <code>Father</code> 类和 <code>Son</code> 类，继承关系，可以考虑建一个如 <code>FatherPrivate.h</code> 的私有header：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FatherPrivate.h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Father</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *privateThingSonNeed;</span><br><span class="line">- (<span class="keyword">void</span>)privateMethodNeedsSonOverride;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>同时在 <code>Father.m</code> 和 <code>Son.m</code> 中同时 <code>import</code> 这个私有header，这样 <code>Father</code> 和 <code>Son</code> 内部对于定义的属性和方法都是透明的，而对外部是隐藏的（因为两个类的header中都没有 <code>import</code> 这个私有header）</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/pikacool1993/2021/02/07/layoutengine/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="pikacool">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pikacool">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/02/07/layoutengine/" itemprop="url">Auto Layout</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-02-07T10:06:58+08:00">2021-02-07</time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Auto-Layout-的生命周期"><a href="#Auto-Layout-的生命周期" class="headerlink" title="Auto Layout 的生命周期"></a>Auto Layout 的生命周期</h3><h4 id="包含了布局在运行时的生命周期等一整套布局引擎系统，用来统一管理布局的创建、更新和销毁。"><a href="#包含了布局在运行时的生命周期等一整套布局引擎系统，用来统一管理布局的创建、更新和销毁。" class="headerlink" title="包含了布局在运行时的生命周期等一整套布局引擎系统，用来统一管理布局的创建、更新和销毁。"></a>包含了布局在运行时的生命周期等一整套布局引擎系统，用来统一管理布局的创建、更新和销毁。</h4><ul>
<li>布局引擎系统叫作 Layout Engine ，是 Auto Layout 的核心，主导着整个界面布局。</li>
</ul>
<p><img src="https://i.loli.net/2021/02/07/EPQoJCiapdD6TG5.png" alt="LayoutEngine.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/pikacool1993/2020/06/19/xcode-instruments/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="pikacool">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pikacool">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/19/xcode-instruments/" itemprop="url">Instruments — Time Profiler耗时分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-06-19T11:20:42+08:00">2020-06-19</time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/pikacool1993/2020/03/02/csharp-base-code/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="pikacool">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pikacool">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/02/csharp-base-code/" itemprop="url">Unity3D 实用小技巧 - C# 常用基础代码汇总</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-02T10:40:59+08:00">2020-03-02</time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Unity3D-实用小技巧-C-常用基础代码汇总"><a href="#Unity3D-实用小技巧-C-常用基础代码汇总" class="headerlink" title="Unity3D 实用小技巧 - C# 常用基础代码汇总"></a>Unity3D 实用小技巧 - C# 常用基础代码汇总</h2><h3 id="DateTime"><a href="#DateTime" class="headerlink" title="DateTime"></a>DateTime</h3><p>DateTime 数字类型，DateTime 是一个包含日期、时间的类型，此类型通过 ToString() 转换为字符串时，可根据传入给 Tostring() 的参数转换为多种字符串格式。</p>
<p><code>System.DateTime currentTime=new System.DateTime();</code></p>
<ul>
<li><p>取当前年月日时分秒：<br><code>currentTime=System.DateTime.Now;</code></p>
</li>
<li><p>取当前年：<code>int 年=currentTime.Year;</code></p>
</li>
<li><p>取当前月：<code>int 月=currentTime.Month;</code></p>
</li>
<li><p>取当前日：<code>int 日=currentTime.Day;</code></p>
</li>
<li><p>取当前时：<code>int 时=currentTime.Hour;</code></p>
</li>
<li><p>取当前分：<code>int 分=currentTime.Minute;</code></p>
</li>
<li><p>取当前秒：<code>int 秒=currentTime.Second;</code></p>
</li>
<li><p>取当前毫秒：<br><code>int 毫秒=currentTime.Millisecond;（变量可用中文）</code></p>
</li>
<li><p>取中文日期显示-年月日时分：<br><code>string strY=currentTime.ToString(&quot;f&quot;); //不显示秒</code></p>
</li>
<li><p>取中文日期显示-年月：<br><code>string strYM=currentTime.ToString(&quot;y&quot;);</code></p>
</li>
<li><p>取中文日期显示-月日：<br><code>string strMD=currentTime.ToString(&quot;m&quot;);</code></p>
</li>
<li><p>取中文年月日：<br><code>string strYMD=currentTime.ToString(&quot;D&quot;);</code></p>
</li>
<li><p>取当前时分，格式为：(14：24)：<br><code>string strT=currentTime.ToString(&quot;t&quot;);</code></p>
</li>
<li><p>取当前时间，格式为：2003-09-23T14:46:48：<br><code>string strT=currentTime.ToString(&quot;s&quot;);</code></p>
</li>
<li><p>取当前时间，格式为：2003-09-2314:48:30Z：<br><code>string strT=currentTime.ToString(&quot;u&quot;);</code></p>
</li>
<li><p>取当前时间，格式为：2003-09-2314:48：<br><code>string strT=currentTime.ToString(&quot;g&quot;);</code></p>
</li>
<li><p>取当前时间，格式为：Tue,23 Sep 2003 14:52:40 GMT：<br><code>string strT=currentTime.ToString(&quot;r&quot;);</code></p>
</li>
<li><p>获得当前时间n 天后的日期时间：<br><code>DateTime newDay = DateTime.Now.AddDays(100);</code></p>
</li>
</ul>
<h3 id="其他类型字符串转换-变量-ToString"><a href="#其他类型字符串转换-变量-ToString" class="headerlink" title="其他类型字符串转换  变量.ToString()"></a>其他类型字符串转换  变量.ToString()</h3><pre><code>12345.ToString(&quot;n&quot;); //生成 12,345.00

12345.ToString(&quot;C&quot;); //生成 ￥12,345.00

12345.ToString(&quot;e&quot;);//生成 1.234500e+004

12345.ToString(&quot;f4&quot;); //生成 12345.0000

12345.ToString(&quot;x&quot;); //生成 3039 (16进制)

12345.ToString(&quot;p&quot;); //生成 1,234,500.00%</code></pre><h3 id="字符型转换转为-32-位数字型"><a href="#字符型转换转为-32-位数字型" class="headerlink" title="字符型转换转为 32 位数字型"></a>字符型转换转为 32 位数字型</h3><pre><code>Int32.Parse(变量) Int32.Parse(&quot;常量&quot;)
Int32.Parse(&quot;123&quot;);//生成 123</code></pre><h3 id="变量-Length-数字型"><a href="#变量-Length-数字型" class="headerlink" title="变量.Length 数字型"></a>变量.Length 数字型</h3><pre><code>取字串长度：如：string str=&quot;中国&quot;
int Len = str.Length ; //Len是自定义变量， str是求测的字串的变量名</code></pre><h3 id="System-Text-Encoding-Default-GetBytes-变量-：字码转换转为比特码"><a href="#System-Text-Encoding-Default-GetBytes-变量-：字码转换转为比特码" class="headerlink" title="System.Text.Encoding.Default.GetBytes(变量)：字码转换转为比特码"></a>System.Text.Encoding.Default.GetBytes(变量)：字码转换转为比特码</h3><pre><code>byte[]bytStr = System.Text.Encoding.Default.GetBytes(str);
然后可得到比特长度：len = bytStr.Length;</code></pre><h3 id="System-Text-StringBuilder-“”-字符串相加，（-号是不是也一样？）"><a href="#System-Text-StringBuilder-“”-字符串相加，（-号是不是也一样？）" class="headerlink" title="System.Text.StringBuilder(“”)- 字符串相加，（+号是不是也一样？）"></a>System.Text.StringBuilder(“”)- 字符串相加，（+号是不是也一样？）</h3><pre><code>System.Text.StringBuilder sb = new System.Text.StringBuilder(&quot;&quot;);
sb.Append(&quot;中华&quot;);
sb.Append(&quot;人民&quot;);
sb.Append(&quot;共和国&quot;);</code></pre><h3 id="变量-Substring-参数1-参数2-：截取字串的一部分，参数1为左起始位数，参数2为截取几位。"><a href="#变量-Substring-参数1-参数2-：截取字串的一部分，参数1为左起始位数，参数2为截取几位。" class="headerlink" title="变量.Substring(参数1,参数2)：截取字串的一部分，参数1为左起始位数，参数2为截取几位。"></a>变量.Substring(参数1,参数2)：截取字串的一部分，参数1为左起始位数，参数2为截取几位。</h3><pre><code>strings1 = str.Substring(0,2);</code></pre><h3 id="char-IsWhiteSpce-字串变量，位数-——逻辑型：查指定位置是否空字符"><a href="#char-IsWhiteSpce-字串变量，位数-——逻辑型：查指定位置是否空字符" class="headerlink" title="char.IsWhiteSpce(字串变量，位数)——逻辑型：查指定位置是否空字符"></a>char.IsWhiteSpce(字串变量，位数)——逻辑型：查指定位置是否空字符</h3><pre><code>string str=&quot;你好 AnimeKing&quot;;
char.IsWhiteSpace(str,2); //结果为：True, 第一个字符是0位，2是第三个字符。</code></pre><h3 id="char-IsPunctuation-‘字符’-——逻辑型：查字符是否是标点符号"><a href="#char-IsPunctuation-‘字符’-——逻辑型：查字符是否是标点符号" class="headerlink" title="char.IsPunctuation(‘字符’) ——逻辑型：查字符是否是标点符号"></a>char.IsPunctuation(‘字符’) ——逻辑型：查字符是否是标点符号</h3><pre><code>char.IsPunctuation(&apos;A&apos;);//返回：False</code></pre><h3 id="int-’字符’-：把字符转为数字，查代码点，注意是单引号"><a href="#int-’字符’-：把字符转为数字，查代码点，注意是单引号" class="headerlink" title="(int)’字符’ ：把字符转为数字，查代码点，注意是单引号"></a>(int)’字符’ ：把字符转为数字，查代码点，注意是单引号</h3><pre><code>(int)&apos;A&apos;; //结果为A字的代码：20013</code></pre><h3 id="char-代码-：把数字转为字符，查代码代表的字符"><a href="#char-代码-：把数字转为字符，查代码代表的字符" class="headerlink" title="(char)代码 ：把数字转为字符，查代码代表的字符"></a>(char)代码 ：把数字转为字符，查代码代表的字符</h3><pre><code>(char)22269; //返回“国”字。</code></pre><h3 id="清除字串前后空格："><a href="#清除字串前后空格：" class="headerlink" title="清除字串前后空格："></a>清除字串前后空格：</h3><pre><code>变量.Trim()</code></pre><h3 id="字串替换-：字串变量-Replace-“子字串”-”替换为”"><a href="#字串替换-：字串变量-Replace-“子字串”-”替换为”" class="headerlink" title="字串替换 ：字串变量.Replace(“子字串”,”替换为”)"></a>字串替换 ：字串变量.Replace(“子字串”,”替换为”)</h3><pre><code>string str=&quot;中国&quot;;
str=str.Replace(&quot;国&quot;,&quot;央&quot;); //将国字换为央字
Response.Write(str); //输出结果为“中央”</code></pre><h3 id="字串对比一般都用-if-str1-str2-，并且也有别的方法"><a href="#字串对比一般都用-if-str1-str2-，并且也有别的方法" class="headerlink" title="字串对比一般都用: if(str1==str2){ }  ，并且也有别的方法"></a>字串对比一般都用: if(str1==str2){ }  ，并且也有别的方法</h3><pre><code>(1)  string str1; str2
//语法:str1.EndsWith(str2); __检测字串str1是否以字串str2结尾,返回布尔值.如：    if(str1.EndsWith(str2)){ Response.Write(&quot;字串str1是以&quot;+str2+&quot;结束的&quot;); }
(2) //语法:str1.Equals(str2);__检测字串str1是否与字串str2相等,返回布尔值,用法同上
(3) //语法Equals(str1,str2); __检测字串str1是否与字串str2相等,返回布尔值,用法同上</code></pre><h3 id="IndexOf-、LastIndexOf-：查找字串中指定字符或字串首次（最后一次）出现的位置，返回索引值"><a href="#IndexOf-、LastIndexOf-：查找字串中指定字符或字串首次（最后一次）出现的位置，返回索引值" class="headerlink" title="IndexOf()、LastIndexOf()：查找字串中指定字符或字串首次（最后一次）出现的位置，返回索引值"></a>IndexOf()、LastIndexOf()：查找字串中指定字符或字串首次（最后一次）出现的位置，返回索引值</h3><pre><code>str1.IndexOf(&quot;字&quot;)；//查找“字”在str1中的索引值（位置）
str1.IndexOf(&quot;字串&quot;)；//查找“字串”的第一个字符在str1中的索引值（位置）
str1.IndexOf(&quot;字串&quot;,3,2)；//从str1第4个字符起，查找2个字符，查找“字串”的第一个字符在str1中的索引值（位置）</code></pre><h3 id="Insert-在字串中指定索引位插入指定字符"><a href="#Insert-在字串中指定索引位插入指定字符" class="headerlink" title="Insert()在字串中指定索引位插入指定字符"></a>Insert()在字串中指定索引位插入指定字符</h3><pre><code>str1.Insert(1,&quot;字&quot;);在str1的第二个字符处插入“字”，如果str1=&quot;中国&quot;，插入后为“中字国”；</code></pre><h3 id="PadLeft-、PadRight-：在字串左（或右）加空格或指定char字符，使字串达到指定长度"><a href="#PadLeft-、PadRight-：在字串左（或右）加空格或指定char字符，使字串达到指定长度" class="headerlink" title="PadLeft()、PadRight() ：在字串左（或右）加空格或指定char字符，使字串达到指定长度"></a>PadLeft()、PadRight() ：在字串左（或右）加空格或指定char字符，使字串达到指定长度</h3><pre><code>string str1=&quot;中国人&quot;;
str1=str1.PadLeft(10,&apos;1&apos;); //无第二参数为加空格 ,结果为“1111111中国人” ， 字串长为10</code></pre><h3 id="Remove-：从指定位置开始删除指定数的字符"><a href="#Remove-：从指定位置开始删除指定数的字符" class="headerlink" title="Remove()：从指定位置开始删除指定数的字符"></a>Remove()：从指定位置开始删除指定数的字符</h3><pre><code>string str1=&quot;我是萨达姆的崇拜者之一&quot;;
str1.Remove(5,4); //结果为“我是萨达姆之一”</code></pre><h3 id="判断是否存在文件夹，没有则创建"><a href="#判断是否存在文件夹，没有则创建" class="headerlink" title="判断是否存在文件夹，没有则创建"></a>判断是否存在文件夹，没有则创建</h3><pre><code>if (Directory.Exists(url) == false)
{
    Directory.CreateDirectory(url);
}</code></pre><h3 id="方法中的参数，返回值"><a href="#方法中的参数，返回值" class="headerlink" title="方法中的参数，返回值"></a>方法中的参数，返回值</h3><p>ref 型参数：该种类型的参数传递变量地址给方法（引用传递），传递前变量必须初始化。该类型与out型的区别在于：</p>
<ul>
<li>ref 型传递变量前，变量必须初始化，否则编译器会报错, 而 out 型则不需要初始化。</li>
<li>ref 型传递变量，数值可以传入方法中，而 out 型无法将数据传入方法中。换而言之，ref 型有进有出，out 型只出不进。</li>
</ul>
<p>out 型参数：与 ref 型类似，仅用于传回结果。</p>
<p>注意：</p>
<ul>
<li><p>out 型数据在方法中必须要赋值，否则编译器会报错。</p>
<p>  如:如下若将代码中的 sum 1 方法的方法体</p>
<p>  改为 a+=b ; 则编译器会报错。原因：out 型只出不进，在没给 a 赋值前是不能使用的</p>
<p>  改为 b+=b+2 ; 编译器也会报错。原因：out 型数据在方法中必须要赋值。</p>
</li>
<li><p>重载方法时若两个方法的区别仅限于一个参数类型为 ref 另一个方法中为 out ，编译器会报错</p>
<p>  如：若将下面的代码中将方法名 vsum1 改为 sum（或者将方法名 sum 改为 sum1），编译器会报错。</p>
<p>  Error 1 Cannot define overloaded method ‘sum’ because it differs from another method only on ref and out</p>
<p>  原因：参数类型区别仅限于 为 ref 与为 out 时，若重载对编译器而言两者的元数据表示完全相同。</p>
<pre><code>classC
{
    //1. in型参数
    publicvoidsum(int a, int b) {
        a += b;
    }
    //2. ref型参数
    publicvoidsum(refint a, int b)
    {
        a += b;
    }
    //3. out型参数
    publicvoidsum1(outint a, int b)
    {
        a = b+2;
    }
    publicstaticvoidMain(string[] args)
    {
        C c = new C();
        int a = 1, b = 2;
        c.sum(a,b);
        Console.WriteLine(&quot;a:{0}&quot;, a);
        a = 1; b = 2;
        c.sum(ref a, b);
        Console.WriteLine(&quot;ref a:{0}&quot;, a);
        a = 1; b = 2;
        c.sum1(out a, b);
        Console.WriteLine(&quot;out a:{0}&quot;, a);
    }
}</code></pre></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/pikacool1993/2019/07/25/swift-learn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="pikacool">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pikacool">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/25/swift-learn/" itemprop="url">Swift5.0边学边记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-07-25T22:35:37+08:00">2019-07-25</time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Swift5-0边学边记"><a href="#Swift5-0边学边记" class="headerlink" title="Swift5.0边学边记"></a>Swift5.0边学边记</h1><h2 id="swiftc"><a href="#swiftc" class="headerlink" title="swiftc"></a>swiftc</h2><ul>
<li><p>存放路径</p>
<pre><code>Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin</code></pre></li>
<li><p>操作</p>
<p>  生成语法树</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ swiftc -dump-ast main.swift</span><br></pre></td></tr></table></figure>


</li>
</ul>
<pre><code>生成最简洁的SIL代码

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swiftc -emit-sil main.swift</span><br></pre></td></tr></table></figure>


生成LLVM IR代码

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ swiftc -emit-ir main.swift</span><br></pre></td></tr></table></figure>


生成汇编代码

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ swiftc -emit-assembly main.swift -o main.s</span><br></pre></td></tr></table></figure></code></pre><h2 id="汇编"><a href="#汇编" class="headerlink" title="汇编"></a>汇编</h2><h3 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a>寄存器</h3><h4 id="AT-amp-T"><a href="#AT-amp-T" class="headerlink" title="AT&amp;T"></a>AT&amp;T</h4><ul>
<li><p>16个常用寄存器</p>
<p>  <code>rax, rbx, rcx, rdx, rsi, rdi, rbp, rsp</code><br>  <code>r8, r9, r10, r11, r12, r13, r14, r15</code></p>
</li>
<li><p>寄存器具体用途</p>
<p>  rax, rdx常作为函数返回值使用</p>
<p>  rdi, rsi, rdx, rcx, r8, r9等寄存器常用于存放函数参数</p>
<p>  rsp, rbp用于栈操作</p>
<p>  rip作为指令指针，存放着CPU下一条要执行的指令地址，一旦CPU读取一条指令，rip会自动指向下一条指令</p>
</li>
</ul>
<h4 id="ARM64"><a href="#ARM64" class="headerlink" title="ARM64"></a>ARM64</h4><h6 id="寄存器-1"><a href="#寄存器-1" class="headerlink" title="寄存器"></a>寄存器</h6><ul>
<li><p>ARM64 有34个寄存器，包括31个通用寄存器、SP、PC、CPSR</p>
<table>
<thead>
<tr>
<th align="center">寄存器</th>
<th align="center">位数</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">x0-x30</td>
<td align="center">64bit</td>
<td align="center">通用寄存器，如果有需要可以当做32bit使用：wO-w30</td>
</tr>
<tr>
<td align="center">FP(x29)</td>
<td align="center">64bit</td>
<td align="center">保存栈帧地址(栈底指针)</td>
</tr>
<tr>
<td align="center">LR(x30)</td>
<td align="center">64bit</td>
<td align="center">通常称X30为程序链接寄存器，保存子程序结束后需要执行的下一条指令</td>
</tr>
<tr>
<td align="center">SP</td>
<td align="center">64bit</td>
<td align="center">保存栈指针,使用 SP/WSP 来进行对 SP 寄存器的访问</td>
</tr>
<tr>
<td align="center">PC</td>
<td align="center">64bit</td>
<td align="center">程序计数器，俗称PC指针，总是指向即将要执行的下一条指令,在arm64中，软件是不能改写PC寄存器的</td>
</tr>
<tr>
<td align="center">CPSR</td>
<td align="center">64bit</td>
<td align="center">状态寄存器</td>
</tr>
</tbody></table>
</li>
<li><p>用途</p>
<p>  x0 - x7: 用于子程序调用时的参数传递，x0还用于返回值传递，当使用 r0 - r30 访问时，它就是一个64位的数。当使用 w0 - w30 访问时，访问的是这些寄存器的低32位</p>
</li>
<li><p>指令</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MOV    X1，X0         ;将寄存器X0的值传送到寄存器X1</span><br><span class="line">ADD    X0，X1，X2     ;寄存器X1和X2的值相加后传送到X0</span><br><span class="line">SUB    X0，X1，X2     ;寄存器X1和X2的值相减后传送到X0</span><br><span class="line">AND    X0，X0，#0xF    ; X0的值与0xF相位与后的值传送到X0</span><br><span class="line">ORR    X0，X0，#9      ; X0的值与9相位或后的值传送到X0</span><br><span class="line">EOR    X0，X0，#0xF    ; X0的值与0xF相异或后的值传送到X0</span><br><span class="line">LDR    X5，[X6，#0x08]        ；X6寄存器加0x08的和的地址值内的数据传送到X5</span><br><span class="line">STR X0, [SP, #0x8]         ；X0寄存器的数据传送到SP+0x8地址值指向的存储空间</span><br><span class="line">STP  x29, x30, [sp, #0x10]    ;入栈指令</span><br><span class="line">LDP  x29, x30, [sp, #0x10]    ;出栈指令</span><br><span class="line">CBZ  ;比较（Compare），如果结果为零（Zero）就转移（只能跳到后面的指令）</span><br><span class="line">CBNZ ;比较，如果结果非零（Non Zero）就转移（只能跳到后面的指令）</span><br><span class="line">CMP  ;比较指令，相当于SUBS，影响程序状态寄存器CPSR </span><br><span class="line">B/BL  ;绝对跳转#imm， 返回地址保存到LR（X30）</span><br><span class="line">RET   ;子程序返回指令，返回地址默认保存在LR（X30）</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="lldb常用指令"><a href="#lldb常用指令" class="headerlink" title="lldb常用指令"></a>lldb常用指令</h3><ul>
<li><p>读取寄存器的值</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ register read/格式</span><br><span class="line">exp:</span><br><span class="line">$ register read/x</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改寄存器的值</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ register write 寄存器名称 数值</span><br><span class="line">exp:</span><br><span class="line">$ register write rax 0</span><br></pre></td></tr></table></figure>
</li>
<li><p>读取内存中的值</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ x/数量-格式-字节大小 内存地址</span><br><span class="line">exp:</span><br><span class="line">$ x/3xw 0x0000010</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改内存中的值</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ memory write 内存地址 数值</span><br><span class="line">exp:</span><br><span class="line">$ memory write 0x0000010 10</span><br></pre></td></tr></table></figure>
</li>
<li><p>格式</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x 是16进制</span><br><span class="line">f 是浮点</span><br><span class="line">d 是十进制</span><br></pre></td></tr></table></figure>
</li>
<li><p>字节大小</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b - byte 1字节</span><br><span class="line">h - half word 2字节</span><br><span class="line">w - word 4字节</span><br><span class="line">g - giant word 8字节</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>规律</p>
<p>  内存地址格式为： 0x4bdc(%rip), 一般是全局变量， 全局区（数据段）</p>
<p>  内存地址格式为： -0x78(%rbp), 一般是局部变量，栈空间</p>
<p>  内存地址格式为： 0x10(%rax), 一般是堆空间</p>
</li>
<li><p>查看调用栈</p>
<p>  <code>bt</code></p>
</li>
</ul>
<h2 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h2><ul>
<li><p>双重可选</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var num : Int?? = nil</span><br><span class="line">print(num ?? 10)</span><br></pre></td></tr></table></figure>


</li>
</ul>
<pre><code>输出结果：

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Optional(10)  // 为什么还会输出一个可选的10</span><br></pre></td></tr></table></figure>


在Swift源码中是这样描述的

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">///   - defaultValue: A value to use as a default. `defaultValue` is the same</span><br><span class="line">///     type as the `Wrapped` type of `optional`.</span><br><span class="line"></span><br><span class="line">public func ?? &lt;T&gt;(optional: T?, defaultValue: @autoclosure () throws -&gt; T)</span><br><span class="line">   rethrows -&gt; T &#123;</span><br><span class="line"> 		switch optional &#123;</span><br><span class="line"> 			case .some(let value):</span><br><span class="line">   			return value</span><br><span class="line"> 			case .none:</span><br><span class="line">   			return try defaultValue()</span><br><span class="line"> 		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre><h2 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/pikacool1993/2019/07/22/objc-before-main/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="pikacool">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pikacool">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/22/objc-before-main/" itemprop="url">App启动时在main函数之前做了什么</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-07-22T16:01:06+08:00">2019-07-22</time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="App-启动时在执行-main-之前做了什么"><a href="#App-启动时在执行-main-之前做了什么" class="headerlink" title="App 启动时在执行 main() 之前做了什么"></a>App 启动时在执行 main() 之前做了什么</h2><ul>
<li><p>编译的几个主要过程，生成可执行文件</p>
<ul>
<li>首先，你写好代码后，<code>LLVM</code> 会预处理你的代码，比如把宏嵌入到对应的位置</li>
<li>预处理完后，<code>LLVM</code> 会对代码进行词法分析和语法分析，生成 <code>AST</code> 。<code>AST</code> 是抽象语法树，结构上比代码更精简，遍历起来更快，所以使用 <code>AST</code> 能够更快速地进行静态检查，同时还能更快地生成 <code>IR</code>（中间表示）</li>
<li>最后 <code>AST</code> 会生成 <code>IR</code>，<code>IR</code> 是一种更接近机器码的语言，区别在于和平台无关，通过 <code>IR</code> 可以生成多份适合不同平台的机器码。对于 <code>iOS</code> 系统，<code>IR</code> 生成的可执行文件就是 <code>Mach-O</code></li>
</ul>
</li>
<li><p>加载动态链接库</p>
<p>  查看一个 APP 都使用了哪些动态库，包括系统自带的动态库和第三方动态库，这些动态库将会在动态链接过程中被加载</p>
<p>  找到App可执行文件路径，通过 <code>otool</code> 命令:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ otool -L TestMain</span><br></pre></td></tr></table></figure>


</li>
</ul>
<pre><code>-L 参数打印出所有 link 的 framework（去掉了版本信息如下）

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">TestMain:</span><br><span class="line">	/System/Library/Frameworks/Foundation.framework/Foundation</span><br><span class="line">	/usr/lib/libobjc.A.dylib</span><br><span class="line">	/usr/lib/libSystem.B.dylib</span><br><span class="line">	/System/Library/Frameworks/CoreFoundation.framework/CoreFoundation</span><br><span class="line">	/System/Library/Frameworks/UIKit.framework/UIKit</span><br></pre></td></tr></table></figure>


可以看到有两个默认添加的 `lib`: `libobjc`(`objc` 和 `runtime`), `libSystem` 中包含了很多系统级别的 `lib`, 比如我们熟知的 `libdispatch`（GCD）, `libsystem_c`（C语言库）, `libsystem_blocks`（Block）, `libcommonCrypto`（加密库，比如常用的 `md5` 函数）

这些 `lib` 都是 `dylib` 格式的（如 `Windows` 中的 `dll`）, 使用动态链接有如下优点：

- 代码共用： 很多程序都动态链接了这些 lib，但它们在内存和磁盘中中只有一份
- 易于维护： 由于被依赖的 lib 是程序执行时才 link 的，所以这些 lib 很容易做更新，比如`libSystem.dylib` 是 `libSystem.B.dylib` 的替身，哪天想升级直接换成 `libSystem.C.dylib` 然后再替换替身就行了
- 减少可执行文件体积：相比静态链接，动态链接在编译时不需要打进去，所以可执行文件的体积要小很多</code></pre><ul>
<li><p>dyld</p>
<p>  <code>dyld(the dynamic link editor)</code>, 动态链接器，概述 <code>dyld</code> 做了如下几件事：</p>
<ul>
<li>先执行 <code>Mach-O</code> 文件，根据 <code>Mach-O</code> 文件里 <code>undefined</code> 的符号加载对应的动态库，系统会设置一个共享缓存来解决加载的递归依赖问题</li>
<li>加载后，将 <code>undefined</code> 的符号绑定到动态库里对应的地址上</li>
<li>最后再处理 <code>+load</code> 方法，<code>main</code> 函数返回后运行 <code>static terminator</code></li>
</ul>
</li>
<li><p>ImageLoader</p>
<p>  将文件加载进内存，且每一个文件对应一个 <code>ImageLoader</code> 实例来负责加载。</p>
<ul>
<li>在程序运行时它先将动态链接的 <code>image</code> 递归加载 （也就是上面加载的递归依赖问题）</li>
<li>再从可执行文件 <code>image</code> 递归加载所有符号</li>
</ul>
</li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li><code>dyld</code> 开始将程序二进制文件(<code>Mach-O</code>)初始化</li>
<li>交由 <code>ImageLoader</code> 读取 <code>image</code>，其中包含了我们的类、方法等各种符号</li>
<li>由于 <code>runtime</code> 向 <code>dyld</code> 绑定了回调，当 <code>image</code> 加载到内存后，<code>dyld</code> 会通知 <code>runtime</code> 进行处理</li>
<li><code>runtime</code> 接手后调用 <code>map_images</code> 做解析和处理，接下来 <code>load_images</code> 中调用 <code>call_load_methods</code> 方法，遍历所有加载进来的 <code>Class</code>，按继承层级依次调用 <code>Class</code> 的 <code>+load</code> 方法和其 <code>Category</code> 的 <code>+load</code> 方法</li>
</ul>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p>Q: 重载自己 <code>Class</code> 的 <code>+load</code> 方法时需不需要调父类？<br><br>A: <code>runtime</code> 负责按继承顺序递归调用，所以不能调 <code>super</code></p>
<p>Q: 在自己 <code>Class</code> 的 <code>+load</code> 方法时能不能替换系统 <code>framework</code>（比如 <code>UIKit</code>）中的某个类的方法实现<br><br>A: 可以，因为动态链接过程中，所有依赖库的类是先于自己的类加载的</p>
<p>Q: 重载 <code>+load</code> 时需要手动添加 <code>@autoreleasepool</code> 么？<br><br>A: 不需要，在 <code>runtime</code> 调用 <code>+load</code> 方法前后是加了 <code>objc_autoreleasePoolPush()</code> 和 <code>objc_autoreleasePoolPop()</code> 的。</p>
<p>Q: 想让一个类的 <code>+load</code> 方法被调用是否需要在某个地方 <code>import</code> 这个文件？<br><br>A: 不需要，只要这个类的符号被编译到最后的可执行文件中，<code>+load</code> 方法就会被调用（Reveal SDK 就是利用这一点，只要引入到工程中就能工作）</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/pikacool1993/2019/07/18/hexo-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="pikacool">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pikacool">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/18/hexo-install/" itemprop="url">mac下使用hexo搭建blog</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-07-18T13:01:25+08:00">2019-07-18</time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="安装-nvm（Node-Version-Manager）"><a href="#安装-nvm（Node-Version-Manager）" class="headerlink" title="安装 nvm（Node Version Manager）"></a>安装 nvm（Node Version Manager）</h2><p>Terminal中运行 <br></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.8/install.sh | bash</span><br></pre></td></tr></table></figure>

<p><code>v0.33.8</code> 是nvm的版本号，最新版本详见： <br></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/creationix/nvm/blob/master/README.md</span><br></pre></td></tr></table></figure>

<p>安装完成后会提示 <br></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">=&gt; Close and reopen your terminal to start using NVM</span><br></pre></td></tr></table></figure>

<p>重启 terminal，输入 <code>nvm</code> 验证是否安装成功, 当一行出现 <code>Node Version Manager</code> 时说明安装成功</p>
<p>使用 nvm 安装 note.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nvm install stable</span><br></pre></td></tr></table></figure>

<p>安装完成后安装 hexo，这一步时间稍微比较长：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g -hexo</span><br></pre></td></tr></table></figure>

<p>然后选择一个文件路径创建一个文件夹：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir Blog</span><br><span class="line">$ cd Blog</span><br><span class="line">$ hexo init .</span><br><span class="line">$ ls</span><br></pre></td></tr></table></figure>

<p>如果遇到 <code>hexo: command not found</code> 的错误， 解决方法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nvm ls</span><br></pre></td></tr></table></figure>

<p>log信息如下：</p>
<pre><code>       v0.10.48
-&gt;      v12.6.0
default -&gt; v12.6.0
node -&gt; stable (-&gt; v12.6.0) (default)
stable -&gt; 12.6 (-&gt; v12.6.0) (default)
iojs -&gt; N/A (default)
unstable -&gt; N/A (default)
lts/* -&gt; lts/dubnium (-&gt; N/A)
lts/argon -&gt; v4.9.1 (-&gt; N/A)
lts/boron -&gt; v6.17.1 (-&gt; N/A)
lts/carbon -&gt; v8.16.0 (-&gt; N/A)
lts/dubnium -&gt; v10.16.0 (-&gt; N/A)</code></pre><p>选择使用版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ nvm use v12.6.0</span><br><span class="line">$ nvm alias default v12.6.0</span><br></pre></td></tr></table></figure>

<p>生成出的目录结构：</p>
<pre><code>.
├── _config.yml
├── package.json
├── db.json
├── package-lock.json
├── node_modules
├── scaffolds
├── public
├── source
|   └── _posts
└── themes</code></pre><p>新建一篇文章</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new mac下使用hexo搭建blog</span><br><span class="line">$ open source/_posts/mac下使用hexo搭建blog.md</span><br></pre></td></tr></table></figure>

<p>编辑完成后生成html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>本地预览</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br><span class="line">=&gt; [info] Hexo is running at localhost:4000/. Press Ctrl+C to stop.</span><br></pre></td></tr></table></figure>

<p>Theme，去官方提供的<a href="https://github.com/tommy351/hexo/wiki/Themes">主题列表</a>中选个现成的，按照里面的方法pull下来，如light主题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone git://github.com/tommy351/hexo-theme-light.git themes/light</span><br></pre></td></tr></table></figure>

<p><code>_config.yml</code> 配置文件中设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">theme: light</span><br></pre></td></tr></table></figure>

<p>重新generate和server预览，就看到变化了。</p>
<h2 id="deploy"><a href="#deploy" class="headerlink" title="deploy"></a>deploy</h2><p>在 github 上创建一个 respository <br><br>在 <code>_config.yml</code> 中配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">type: git</span><br><span class="line">repository: https://github.com/pikacool1993/pikacool1993.github.io.git</span><br></pre></td></tr></table></figure>

<p>然后执行 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>以下提示说明部署成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INFO  Deploy done: git</span><br></pre></td></tr></table></figure>

<p>若出现错误</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR Deployer not found: git</span><br></pre></td></tr></table></figure>

<p>执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<h2 id="绑定域名"><a href="#绑定域名" class="headerlink" title="绑定域名"></a>绑定域名</h2><p>在万网买了个域名 <code>pikacool.cn</code>, 然后将独立域名与GitHub Pages的空间绑定 <br></p>
<p>在Blog站点 public 目录下创建一个名为CNAME的文本文件，并写入你要绑定的域名 <code>pikacool.cn</code> <br></p>
<p>提交到github上去</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>域名后台解析设置中添加记录，DNS域名解析最常用的是A记录和CNAME记录，A记录把域名解析到服务器IP，CNAME相当于把一个域名指向另一个域名，因此我这个用的是CNAME，要是托管的服务器也是自己搭的那就用A记录了。 <br></p>
<p>添加一个 A 记录</p>
<pre><code>记录类型：A
主机记录：@
解析线路：默认
记录值：创建的GitHub respository ip地址( ping 一下就看到了) 如：185.199.109.153</code></pre><p>添加一个 CNAME 记录</p>
<pre><code>记录类型：CNAME
主机记录：www
解析线路：默认
记录值：pikacool1993.github.io</code></pre><p>使用下面的命令测一下域名的解析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ dig pikacool.cn +nostats +nocomments +nocmd</span><br><span class="line">	</span><br><span class="line">output =&gt;:</span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; pikacool.cn +nostats +nocomments +nocmd</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;pikacool.cn.			IN	A</span><br><span class="line">pikacool.cn.		60	IN	A	185.199.109.153</span><br></pre></td></tr></table></figure>

<h2 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h2><h4 id="添加sitemap"><a href="#添加sitemap" class="headerlink" title="添加sitemap"></a>添加sitemap</h4><p>使用hexo提供的插件，安装sitemap到本地：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-generator-sitemap</span><br></pre></td></tr></table></figure>

<p>开启sitemap功能：编辑hexo/_config.yml，添加如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plugins:</span><br><span class="line">- hexo-generator-sitemap</span><br></pre></td></tr></table></figure>

<p>访问zipperary/sitemap.xml即可看到站点地图。</p>
<h2 id="图床"><a href="#图床" class="headerlink" title="图床"></a>图床</h2><p><a href="https://sm.ms/" target="_blank" rel="noopener">白嫖网站</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">pikacool</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">pikacool</span>

  

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Muse</a> v6.0.0</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.0"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
