<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="baidu-site-verification" content="vvVgSQUzPU" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <meta name="keywords" content="pikacool|博客|个人|">
    <meta name="description" content="雄关漫道真如铁 而今迈步从头越">
    
    <title>
       Unity 性能优化 -  pikacool
    </title>
    
<link rel="stylesheet" href="/css/style.css">
 
    
      <link rel="icon" href="/images/favicon.ico" />
    
  </head>
  <body>
    <div id="container">
      <div id="main-left">
        <div id="introduce">
          <div class="logo-worp">
            <a href="/"><img class="logo" src="/images/logo.png" alt=""/></a>
          </div>
          <ul>
            
              <li><a href="/"> Home </a></li>
            
              <li><a href="/archives"> Archive </a></li>
            
              <li><a href="/about"> About </a></li>
            
            <li>
              <img id="search-img" src="/images/search.svg" alt="search" />
            </li>
          </ul>
           
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Unity-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="post-toc-number">1.</span> <span class="post-toc-text">Unity 性能优化</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#GC"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">GC</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E7%89%A9%E7%90%86"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">物理</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%8A%A8%E7%94%BB"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">动画</span></a></li></ol></li></ol> 
          
        </div>
      </div>
      <div id="main-right"><div id="post">
    
    <header class="article-header">
        <h1>
            Unity 性能优化
        </h1>
    </header>
    
    <div class="post-meta">
        <time class="post-data" datetime="2023-09-01T10:24:25.000Z" itemprop="datePublished">
            2023-09-01
        </time>
        
        
    </div>
    
    <div class="post-entry">
        <h1 id="Unity-性能优化"><a href="#Unity-性能优化" class="headerlink" title="Unity 性能优化"></a>Unity 性能优化</h1><h2 id="GC"><a href="#GC" class="headerlink" title="GC"></a>GC</h2><ul>
<li>减少垃圾数量<ul>
<li>使用缓存：避免内存重复、重新分配</li>
<li>减少在 <code>Update</code> 这种频繁调用的方法中分配内存</li>
<li>使用 <code>Clear</code> 清理集合，而不是每次生成</li>
<li>善用对象池</li>
</ul>
</li>
<li>减少不必要的堆内存分配<ul>
<li><code>String</code> 是不可变的，每次更改都是创建一个新的对象<ul>
<li>将常用字符串缓存</li>
<li>对于频繁更新的 <code>Text</code> 组件应该把其中变化和不变化的部分分开</li>
<li>对于频繁更新的字符串，使用 <code>StringBuilder</code> 替代</li>
<li>移除 <code>Debug.Log()</code></li>
</ul>
</li>
<li>避免 <code>Unity</code> 方法不恰当调用<ul>
<li>返回数组的方法，会创建新的数组，应在反复使用前缓存</li>
<li>使用 <code>CompareTag</code> 替代 <code>gameObject.tag</code></li>
<li>使用 <code>Input.GetTouch</code> 和 <code>Input.touchCount</code> 替代 <code>Input.touches</code></li>
<li>使用 <code>Physics.SphereCastNonAlloc</code> 替代 <code>Pysiscs.SphereCastAll</code></li>
</ul>
</li>
<li>装箱：把值类型变量当引用类型使用，将创建一个临时 <code>Object</code> 封装值类型变量<ul>
<li><code>Object.Eauals</code> 方法参数是 <code>Object</code>，如果传入 <code>int</code> 或 <code>float</code>，则会产生装箱</li>
<li><code>String.Format</code> 同上</li>
<li>就算我们自己代码中避免装箱，插件中也可能发生装箱，应移除这些方法的调用</li>
</ul>
</li>
<li><code>Coroutines</code><ul>
<li><code>StartCoroutine</code> 产生少量垃圾（堆内存分配），因为 <code>Unity</code> 需要创建实例来维护</li>
<li>减少在性能敏感处调用  <code>StartCoroutine</code> ；避免嵌套调用，可能导致调用延迟</li>
<li><code>yield return 0</code> 会导致装箱，使用 <code>null</code> 代替</li>
<li>提前缓存 <code>new WaitForSeconds()</code> 对象，复用</li>
<li>如果 <code>coroutine</code> 产生太多垃圾，使用 <code>Undate</code> 或消息机制替代 <code>coroutine</code></li>
</ul>
</li>
<li>方法引用<ul>
<li>在 <code>Unity</code> 中，匿名方法、命名方法的引用是一个引用类型变量，产生堆分配</li>
<li>闭包会显著增加内存占用和堆分配，因为捕获了临时变量</li>
<li>在 <code>gameplay</code> 中避免使用匿名函数、闭包</li>
<li>避免使用 <code>LINQ</code>、正则表达式，因为都会产生装箱</li>
</ul>
</li>
<li>从代码架构上避免不必要的 <code>GC</code> 检测<ul>
<li><code>struct</code> 不要包含引用类型字段，这会导致检测所有字段</li>
<li>类中减少不必要的引用字段</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="物理"><a href="#物理" class="headerlink" title="物理"></a>物理</h2><ul>
<li>减少射线频率、长度、layer</li>
<li>善用 Physics Matrix</li>
<li>不要移动静态 <code>Collider</code>，需要移动的话加 <code>RigidBody</code></li>
<li>尽量使用简单的 <code>Collider</code> 替代 <code>MeshCollider</code>；不同类型进行碰撞检测的相对成本是按照以下顺序排列的，从最耗费资源到最不耗费资源：三角形网格、凸包（三角形网格）、胶囊体、球体、立方体、平面、点</li>
<li>控制好 <code>FixedUpdate</code> 的频率，1s 建议不要执行超过30次，因为 <code>FixedUpdate</code> 执行 <code>Physics</code>，如果<code>Update</code> 卡顿会导致 <code>FixedUpdate</code> 执行多次，继而 <code>Update</code> 更加卡顿，形成恶性循环</li>
</ul>
<h2 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h2><ul>
<li>文件压缩，去除无用通道，比如 <code>Scale</code>，降低精度保存两位有效小数，设置数值范围压缩数据等</li>
<li>GPU 加速动画播放</li>
<li>开启 Unity 的优化选项</li>
<li>减少关键帧</li>
</ul>

    </div>
    <!--畅言PC和WAP自适应版-->
  
</div></div>
    </div>
    <div id="footer">雄关漫道真如铁 而今迈步从头越</div>
    <img id="top" src="/images/up-circle.svg" alt="top" />
    
  </body>
</html>
<!-- 加载主题脚本文件 -->

<script src="/scripts/utone.js"></script>


<script type="text/javascript">
  window.onload = function() {
    scroll.init()
    siteSearch.init()
  }
</script>
